######################################## e20220517022303 ########################################
.moirai/cmd/j20220517022303.json#output	output.txt
.moirai/cmd/j20220517022303.json#stdout	.moirai/e20220517022303/tmp/stdout
https://moirai2.github.io/schema/daemon/command	.moirai/cmd/j20220517022303.json
https://moirai2.github.io/schema/daemon/execid	e20220517022303
https://moirai2.github.io/schema/daemon/execute	completed
https://moirai2.github.io/schema/daemon/processtime	0
https://moirai2.github.io/schema/daemon/rootdir	/Users/ah3q/Sites/moirai2
https://moirai2.github.io/schema/daemon/timecompleted	1652721783
https://moirai2.github.io/schema/daemon/timeended	1652721783
https://moirai2.github.io/schema/daemon/timeregistered	1652721783
https://moirai2.github.io/schema/daemon/timestarted	1652721783
https://moirai2.github.io/schema/daemon/workdir	.moirai/e20220517022303
######################################## log ########################################
registered	1652721783
start	1652721783
end	1652721783
completed	1652721783
######################################## stdout ########################################

######################################## bash ########################################
#!/bin/sh
export PATH=/Users/ah3q/Sites/moirai2/.moirai/bin:/Users/ah3q/Sites/moirai2/bin:$PATH
cmdurl=".moirai/cmd/j20220517022303.json"
execid="e20220517022303"
rootdir="/Users/ah3q/Sites/moirai2"
workdir=".moirai/e20220517022303"
tmpdir=".moirai/e20220517022303/tmp"
output=$tmpdir/output
stdout=$tmpdir/stdout
########## init ##########
cd $rootdir
touch $workdir/status.txt
touch $workdir/log.txt
function status() { echo "$1	"`date +%s` >> $workdir/status.txt ; }
function record() { echo "$1	$2" >> $workdir/log.txt ; }
mkdir -p /tmp/$execid
ln -s /tmp/$execid $tmpdir
status start
########## command ##########
ls -lt > $output;
#############################
status end
mv $output output.txt
output=output.txt
if [[ "$(declare -p output)" =~ "declare -a" ]]; then
for out in ${output[@]} ; do
record "$cmdurl#output" "$out"
done
else
record "$cmdurl#output" "$output"
fi
if [[ "$(declare -p stdout)" =~ "declare -a" ]]; then
for out in ${stdout[@]} ; do
record "$cmdurl#stdout" "$out"
done
else
record "$cmdurl#stdout" "$stdout"
fi
echo ""
rm $workdir/tmp
if [ -z "$(ls -A /tmp/$execid)" ]; then
rmdir /tmp/$execid
else
mv /tmp/$execid $workdir/tmp
fi
status=""
if [ "$status" = "" ];then
if [ -s $workdir/stderr.txt ]; then
status=error
fi
fi
if [ "$status" = "" ]; then
status=completed
fi
status $status
