{"https://moirai2.github.io/schema/daemon/input":["$directory","$genome",{"$r":"R"}],"https://moirai2.github.io/schema/daemon/bash":["#basename=$(basename $directory)","#fullpath=$(perl -e 'use File::Basename; use Cwd \"abs_path\"; print abs_path($ARGV[0]);' $directory)","#cp -r $fullpath $workdir/.","table=$(mergetable12.sh $directory $genome $r $bindir/mergetable12.R)"],"https://moirai2.github.io/schema/daemon/script":[{"https://moirai2.github.io/schema/daemon/script/name":"mergetable12.sh","https://moirai2.github.io/schema/daemon/script/code":["#!/bin/sh","# merge expression table dataset by dataset #","# input: result of featurecounts, *.bed.gz, .expression.gz  #","# output1: gene_id, value1, value2, ... #","# $dir/$genome/$dataset/                #","# count.table                           #","# fpkm.table                            #","# fpkm_assigned.table                   #","# tpm.table                             #","# tpm_assigned.table                    #","# output2: gene_id, cell_id, value  #","# $dataset.txt                      #","# usege) ./mergetable12.sh ~/fs/moirai/singlecell/test/ hg38 /home/shuhei-n/bin/R /osc-fs_home/shuhei-n/moirai/singlecell/scripts/mergetable12.R #","LC_ALL=C","set -eu","############################################","dir=$1","genome=$2","R=$3","rscript=$4","#inputdir=`ls -d $dir/${genome}/${genome}_*[0-9]`","inputdir=`ls -d $dir/${genome}/*`","type=fpkm","###########################################","","for d in $inputdir","do","dataset=`echo ${d##*/}`","","files=`ls $d/*/*.expression.gz`","#echo $d $dataset $files #1>&2","$R -q --slave --args $d $files < $rscript #1>&2","files=`ls $d/*/*.${type}.bed.gz`","for f in $files","do","sampleid=`echo ${f##*/} | sed 's/\\..*//'`","gzip -cd $f | awk '{print $4\"\\t'$sampleid'\\t\"$5}' > $dir/$genome/$dataset/$sampleid.tmp","done","cat $dir/$genome/$dataset/*.tmp |sort -k1,1 > $dir/$genome/$dataset/$dataset.txt","echo $dir/$genome/$dataset/$dataset.txt","rm -r $dir/$genome/$dataset/*.tmp","done"]},{"https://moirai2.github.io/schema/daemon/script/name":"mergetable12.R","https://moirai2.github.io/schema/daemon/script/code":["args <- commandArgs(trailingOnly = T) ","path<-args[1]","#setwd(path)","len=length(args)","x<-args[3:length(args)]","","data <- read.table(file=args[2],header=F,sep=\"\\t\")","data1 <- data[,c(1,7,8,9,10,11)]","depth=length(strsplit(args[2],\"/\")[[1]])","name <- (strsplit(args[2],\"/\")[[1]])[depth - 1 ]","colnames(data1) <- c(\"V1\",name,name,name,name,name)","d1<-data1[,c(1,2)]","d2<-data1[,c(1,3)]","d3<-data1[,c(1,4)]","d4<-data1[,c(1,5)]","d5<-data1[,c(1,6)]","","if (len > 2 ){","for (i in x){","data <- read.table(file=i,header=F,sep=\"\\t\")","data1 <- data[,c(1,7,8,9,10,11)]","depth=length(strsplit(i,\"/\")[[1]])","name<-(strsplit(i,\"/\")[[1]])[depth - 1 ]","#print(name)","colnames(data1) <- c(\"V1\",name,name,name,name,name)","","d1 <- merge(d1,data1[,c(1,2)],by=\"V1\", all.x=T)","d2 <- merge(d2,data1[,c(1,3)],by=\"V1\", all.x=T)","d3 <- merge(d3,data1[,c(1,4)],by=\"V1\", all.x=T)","d4 <- merge(d4,data1[,c(1,5)],by=\"V1\", all.x=T)","d5 <- merge(d5,data1[,c(1,6)],by=\"V1\", all.x=T)","}","}","","name<-c(\"id\",colnames(d1)[2:length(args)])","colnames(d1)<-name","colnames(d2)<-name","colnames(d3)<-name","colnames(d4)<-name","colnames(d5)<-name","write.table(d1,paste(path,\"/count.table\",sep=\"\"), sep=\"\\t\", append=F, quote=F,row.names=F)","write.table(d2,paste(path,\"/tpm.table\",sep=\"\"), sep=\"\\t\", append=F, quote=F,row.names=F)","write.table(d3,paste(path,\"/fpkm.table\",sep=\"\"), sep=\"\\t\", append=F, quote=F,row.names=F)","write.table(d4,paste(path,\"/tpm_assigned.table\",sep=\"\"), sep=\"\\t\", append=F, quote=F,row.names=F)","write.table(d5,paste(path,\"/fpkm_assigned.table\",sep=\"\"), sep=\"\\t\", append=F, quote=F,row.names=F)"]}],"https://moirai2.github.io/schema/daemon/output":"$table"}
