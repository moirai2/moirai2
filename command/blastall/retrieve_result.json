{"https://moirai2.github.io/schema/daemon/input":["$rid","$sequence"],"https://moirai2.github.io/schema/daemon/bash":["output=\"$workdir/output.txt\"","status=`retrieve.pl $rid $output`"],"https://moirai2.github.io/schema/daemon/script":{"https://moirai2.github.io/schema/daemon/script/name":"retrieve.pl","https://moirai2.github.io/schema/daemon/script/code":["#!/usr/bin/perl","use URI::Escape;","use LWP::UserAgent;","use HTTP::Request::Common qw(POST);","my $ua=LWP::UserAgent->new;","my $rid=$ARGV[0];","my $output=$ARGV[1];","open(OUT,\">$output\");","while (true){","$req=new HTTP::Request GET=>\"https://blast.ncbi.nlm.nih.gov/blast/Blast.cgi?CMD=Get&FORMAT_OBJECT=SearchInfo&RID=$rid\";","$response=$ua->request($req);","if($response->content=~/\\s+Status=WAITING/m){sleep 5;next;}","elsif($response->content=~/\\s+Status=FAILED/m){print \"failed\\n\";}","elsif($response->content=~/\\s+Status=UNKNOWN/m){print \"unknown\\n\";}","elsif($response->content=~/\\s+Status=READY/m){print \"success\\n\";last;}","else{print \"failed\\n\";}","}","sleep 10;","$req=new HTTP::Request GET=>\"https://blast.ncbi.nlm.nih.gov/blast/Blast.cgi?CMD=Get&FORMAT_TYPE=Text&RID=$rid\";","$response=$ua->request($req);","print  OUT$response->content;","close(OUT);"]},"https://moirai2.github.io/schema/daemon/output":["$output","$status"]}
