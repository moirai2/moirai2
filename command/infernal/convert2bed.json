{"https://moirai2.github.io/schema/daemon/input":"$input","https://moirai2.github.io/schema/daemon/bash":["output=$workdir/output.bed","convert.pl < $input > $output"],"https://moirai2.github.io/schema/daemon/script":{"https://moirai2.github.io/schema/daemon/script/name":"convert.pl","https://moirai2.github.io/schema/daemon/script/code":["#!/usr/bin/perl","use strict 'vars';","my $query;","my $accession;","my $chromosome;","my $start;","my $end;","my $strand;","my @starts=();","my @ends=();","my $direction;","my $query;","my $position;","my $minimum;","my $maximum;","while(<STDIN>){","chomp;","if(/^Query:\\s+(\\S+)/){","if(scalar(@starts)>0&&scalar(@ends)>0){","processLocation($query,$accession,$chromosome,$start,$end,$strand,\\@starts,\\@ends,$direction);","}","@starts=();","@ends=();","$direction=undef;","$query=$1;","}elsif(/^Accession:\\s+(\\S+)/){","$accession=$1;","}elsif(/^>>\\s+(\\S+):(\\d+)-(\\d+)\\((.)\\)\\s+$/){","if(scalar(@starts)>0&&scalar(@ends)>0){","processLocation($query,$accession,$chromosome,$start,$end,$strand,\\@starts,\\@ends,$direction);","}","$chromosome=$1;","$start=$2;","$end=$3;","$strand=$4;","$position=\"$chromosome\\:$start\\-$end\\(\\$strand\\)\";","@starts=();","@ends=();","$direction=undef;","}elsif(!defined($position)){","next;","}elsif(/^\\s*$position\\s+(\\d+)\\s+.+\\s+(\\d+)\\s*$/){","push(@starts,$1);","push(@ends,$2);","if($1<$2){$direction=\"+\";}","else{$direction=\"-\";}","}","}","if(scalar(@starts)>0&&scalar(@ends)>0){","processLocation($query,$accession,$chromosome,$start,$end,$strand,\\@starts,\\@ends,$direction);","}","sub processLocation{","my $query=shift();","my $accession=shift();","my $chromosome=shift();","my $start=shift();","my $end=shift();","my $strand=shift();","my @starts=@{shift()};","my @ends=@{shift()};","my $direction=shift();","my $s=shift(@starts);","my $e=shift(@ends);","if($direction eq \"+\"){","foreach my $t(@starts){if($t<$s){$s=$t;}}","foreach my $t(@ends){if($t>$e){$e=$t;}}","}else{","foreach my $t(@starts){if($t>$s){$s=$t;}}","foreach my $t(@ends){if($t<$e){$e=$t;}}","}","if($s<$e){","if($strand eq \"+\"){print \"$chromosome\\t\".($start+$s-1).\"\\t\".($start+$e).\"\\t$query\\t255\\t+\\n\";}","else{print \"$chromosome\\t\".($end-$e).\"\\t\".($end-$s+1).\"\\t$query\\t255\\t-\\n\";}","}elsif($e<$s){","if($strand eq \"+\"){print \"$chromosome\\t\".($start+$e-1).\"\\t\".($start+$s).\"\\t$query\\t255\\t-\\n\";}","else{print \"$chromosome\\t\".($end-$s).\"\\t\".($end-$e+1).\"\\t$query\\t255\\t+\\n\";}","}","}"]},"https://moirai2.github.io/schema/daemon/output":"$output"}
