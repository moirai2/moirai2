{"https://moirai2.github.io/schema/daemon/input":["$input","$list","$regexp"],"https://moirai2.github.io/schema/daemon/bash":["withbarcode=$workdir/withbarcode.bam","nobarcode=$workdir/nobarcode.bam","filterbybarcodelist.pl $input $withbarcode $nobarcode $list $regexp"],"https://moirai2.github.io/schema/daemon/script":{"https://moirai2.github.io/schema/daemon/script/name":"filterbybarcodelist.pl","https://moirai2.github.io/schema/daemon/script/code":["#!/usr/bin/perl","use strict 'vars';","use IO::File;","if(scalar(@ARGV)==0){print STDERR \"perl filterbybarcodelist.pl input output others barcode regexp\\n\";exit(0);}","my $input=$ARGV[0];","my $output=$ARGV[1];","my $others=$ARGV[2];","my $barcode=$ARGV[3];","my $regexp=$ARGV[4];","if(!defined($regexp)){$regexp=\"CB:Z:(\\S+)\";}","my $barcodes={};","open(IN,$barcode);","while(<IN>){chomp;$barcodes->{$_}++;}","close(IN);","open(IN,\"samtools view -H $input|\");","my $writer=($output=~/\\.bam$/)?IO::File->new(\"| samtools view -bS '-'>$output 2>/dev/null\"):IO::File->new(\">$output\");","my $writer2=($others=~/\\.bam$/)?IO::File->new(\"| samtools view -bS '-'>$others 2>/dev/null\"):IO::File->new(\">$others\");","while(<IN>){print $writer $_;print $writer2 $_;}","close(IN);","open(IN,\"samtools view $input|\");","while(<IN>){","if(/$regexp/ && exists($barcodes->{$1})){print $writer $_;}","else{print $writer2 $_;}","}","close(IN);","close($writer);","close($writer2);"]},"https://moirai2.github.io/schema/daemon/output":["$withbarcode","$nobarcode"]}
