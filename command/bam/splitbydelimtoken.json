{"https://moirai2.github.io/schema/daemon/input":["$input",{"$index":1},{"$delim":"\\|"}],"https://moirai2.github.io/schema/daemon/bash":["outdir=\"$workdir/out\"","splitbam.pl $input $outdir $index $delim"],"https://moirai2.github.io/schema/daemon/script":{"https://moirai2.github.io/schema/daemon/script/name":"splitbam.pl","https://moirai2.github.io/schema/daemon/script/code":["#!/usr/bin/perl","use FileHandle;","my @headers=();","my $input=$ARGV[0];","if(scalar(@ARGV)<1){exit(0);}","my $outdir=$ARGV[1];","if(!defined($outdir)){$outdir=\"split\";}","mkdir($outdir);","my $index=$ARGV[2];","if(!defined($index)){$index=1;}","my $delim=$ARGV[3];","if(!defined($delim)){$delim=\"\\t\";}","my @headers=();","my $reader=IO::File->new(\"samtools view -H $input|\");","while(<$reader>){chomp;push(@headers,$_);}","close($reader);","my $writers={};","$reader=IO::File->new(\"samtools view $input|\");","while(<$reader>){","\tchomp;","\tmy @tokens=split(/$delim/,$_);","\tmy $label=$tokens[$index];","\tif(!exists($writers->{$label})){","\t\tmy $writer=IO::File->new(\">$outdir/$label.sam\");","\t\t$writers->{$label}=$writer;","\t\tforeach my $header(@headers){print $writer \"$header\\n\";}","\t}","\tmy $writer=$writers->{$label};","\tprint $writer \"$_\\n\";","}","close($reader);","foreach my $label(keys(%{$writers})){","\tmy $writer=$writers->{$label};","\tclose($writer);","\tmy $sam=\"$outdir/$label.sam\";","\tmy $bam=\"$outdir/$label.bam\";","\tmy $command=\"samtools view -bSo $bam $sam 2>/dev/null\";","\tsystem($command);","\tunlink($sam);","}"]},"https://moirai2.github.io/schema/daemon/output":"$outdir"}
