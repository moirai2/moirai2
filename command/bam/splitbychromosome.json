{"https://moirai2.github.io/schema/daemon/input":"$input","https://moirai2.github.io/schema/daemon/bash":["outdir=$workdir/out","splitbychromosome.pl $input $outdir","output=($(ls $workdir/out/*.bam))"],"https://moirai2.github.io/schema/daemon/script":{"https://moirai2.github.io/schema/daemon/script/name":"splitbychromosome.pl","https://moirai2.github.io/schema/daemon/script/code":["#!/usr/bin/perl","use File::Basename;","if(scalar(@ARGV)==0){print STDERR \"perl splitbychromosome.pl input outdir\\n\";exit(0);}","my $input=$ARGV[0];","my $outdir=$ARGV[1];","mkdir($outdir);","chmod(0755,$outdir);","my $basename=basename($input,\".bam\");","my @headers=();","my @outputs=();","my $writers={};","open(IN,\"samtools view -H $input|\");","my $basename=basename($input,\".bam\");","while(<IN>){push(@headers,$_);}","close(IN);","open(IN,\"samtools view $input|\");","while(<IN>){","my @tokens=split(/\t/);","my $chr=$tokens[2];","if($chr eq \"*\"){$chr=\"unmap\";}","if($chr=~/_/){$chr=\"others\";}","if(!exists($writers->{$chr})){","my $output=\"$outdir/$basename.$chr.sam\";","push(@outputs,$output);","my $writer=IO::File->new(\">$output\");","$writers->{$chr}=$writer;","foreach my $header(@headers){print $writer $header;}","}","my $writer=$writers->{$chr};","print $writer $_;","}","close(IN);","foreach my $output(@outputs){","my $basename=basename($output,\".sam\");","my $command=\"samtools view -bSo $outdir/$basename.bam $output 2>/dev/null\";","system($command);","unlink($output);","}"]},"https://moirai2.github.io/schema/daemon/output":["$outdir","$output"]}
