######################################## e202204102348135rhy ########################################
https://moirai2.github.io/schema/daemon/execute	completed
https://moirai2.github.io/schema/daemon/processtime	0
https://moirai2.github.io/schema/daemon/timecompleted	1649602096
https://moirai2.github.io/schema/daemon/timeended	1649602096
https://moirai2.github.io/schema/daemon/timestarted	1649602096
test/D.json#unamea	Linux 0e27e88841b9 5.10.76-linuxkit #1 SMP Mon Nov 8 10:21:19 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux
######################################## status ########################################
registered	1649602094
start	1649602096
end	1649602096
completed	1649602096
######################################## bash ########################################
#!/bin/sh
export PATH=/root:/root/bin:/root/.moirai2/bin:$PATH
cmdurl="test/D.json"
execid="e202204102348135rhy"
workdir="/root/.moirai2/e202204102348135rhy"
rootdir="/root"
tmpdir="/root/.moirai2/e202204102348135rhy/tmp"
unamea=$tmpdir/unamea
########## init ##########
cd $rootdir
touch $workdir/status.txt
touch $workdir/log.txt
function status() { echo "$1	"`date +%s` >> $workdir/status.txt ; }
function record() { echo "$1	$2" >> $workdir/log.txt ; }
mkdir -p /tmp/$execid
ln -s /tmp/$execid $tmpdir
status start
########## command ##########
unamea=$(uname -a)
#############################
status end
if [[ "$(declare -p unamea)" =~ "declare -a" ]]; then
for out in ${unamea[@]} ; do
record "$cmdurl#unamea" "$out"
done
else
record "$cmdurl#unamea" "$unamea"
fi
rm $workdir/tmp
if [ -z "$(ls -A /tmp/$execid)" ]; then
rmdir /tmp/$execid
else
mv /tmp/$execid $workdir/tmp
fi
status=""
if [ -z "$status" ]; then
if [ -s $workdir/stderr.txt ]; then
status=error
fi
fi
if [ -z "$status" ]; then
status=completed
fi
status $status
sleep 1
touch $workdir/status.txt
